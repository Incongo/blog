<div class="post-detail">

    <!-- TÃTULO -->
    <h1>
        <%= publicacion.titulo %>
    </h1>

    <!-- AUTOR -->
    <div class="post-author-box">
        <img src="<%= publicacion.usuario.foto_perfil || '/img/default-avatar.png' %>" class="post-author-avatar">

        <div>
            Autor:
            <a href="/usuario/<%= publicacion.usuario.id_usuario %>">
                <%= publicacion.usuario.nombre %>
            </a>
            <br>
            CategorÃ­a:
            <%= publicacion.categoria ? publicacion.categoria.nombre : "Sin categorÃ­a" %>
        </div>
    </div>

    <!-- CONTENIDO -->
    <p class="post-content">
        <%= publicacion.contenido %>
    </p>

    <!-- ACCIONES -->
    <div class="post-actions">

        <% if (user && user.id===publicacion.id_usuario) { %>
            <a href="/publicaciones/<%= publicacion.id_publicacion %>/editar" class="btn btn-primary">Editar</a>

            <form action="/publicaciones/<%= publicacion.id_publicacion %>/eliminar" method="POST"
                style="display:inline;">
                <button type="submit" class="btn btn-outline-secondary">Eliminar</button>
            </form>
            <% } %>

                <% const totalLikes=publicacion.megusta_publicacion.length; %>

                    <% if (user) { %>
                        <form action="/publicaciones/<%= publicacion.id_publicacion %>/like" method="POST"
                            style="display:inline;">
                            <button type="submit" class="like-btn-detail">
                                ğŸ‘ Me gusta (<%= totalLikes %>)
                            </button>
                        </form>
                        <% } else { %>
                            <p>ğŸ‘ <%= totalLikes %> personas les gusta esto</p>
                            <% } %>

    </div>

</div>

<a href="/publicaciones" class="btn btn-outline-secondary mb-4">Volver</a>

<!-- COMENTARIOS -->
<h2 class="comments-title">Comentarios</h2>

<% if (user) { %>
    <form action="/comentarios/crear" method="POST" class="comment-form mb-4">
        <input type="hidden" name="id_publicacion" value="<%= publicacion.id_publicacion %>">
        <textarea name="texto" required></textarea>
        <button type="submit" class="btn btn-primary">Comentar</button>
    </form>
    <% } else { %>
        <p><a href="/login">Inicia sesiÃ³n</a> para comentar</p>
        <% } %>

            <hr>

            <!-- LISTA DE COMENTARIOS -->
            <% publicacion.comentario.forEach(c=> { %>
                <%- include("../publicaciones/comentarios", { c, user }) %>
                    <% }) %>